<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registry Dashboard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <main class="card">
    <h1 class="brand">Registry Dashboard</h1>

    <div class="controls">
      <label>Search <input id="search" placeholder="search by name or phone"></label>
      <button id="refresh" class="btn small">Refresh</button>
    </div>

    <div id="tableWrap"></div>
    <p class="muted">Data is read from the serverless endpoint.</p>
  </main>
  <script>
  async function fetchData(){
    const res = await fetch('/api/list');
    if(!res.ok) return [];
    return res.json();
  }

  function mkTable(items){
    if(!items || items.length===0) return '<p>No entries yet.</p>';
    const rows = items.map(it=>`<tr><td>${it.name}</td><td>${it.phone}</td><td>${it.address||''}</td><td>${it.children.length}</td><td>${new Date(it.createdAt).toLocaleString()}</td></tr>`).join('');
    return `<table class="data-table"><thead><tr><th>Name</th><th>Phone</th><th>Address</th><th>#Children</th><th>Created</th></tr></thead><tbody>${rows}</tbody></table>`;
  }

  async function load(){
    document.getElementById('tableWrap').innerText='Loading...';
    const data = await fetchData();
    window._registryData = data;
    document.getElementById('tableWrap').innerHTML = mkTable(data);
  }

  document.getElementById('refresh').addEventListener('click', load);
  document.getElementById('search').addEventListener('input', (e)=>{
    const q = e.target.value.toLowerCase().trim();
    const filtered = (window._registryData||[]).filter(it=>it.name.toLowerCase().includes(q)||it.phone.toLowerCase().includes(q));
    document.getElementById('tableWrap').innerHTML = mkTable(filtered);
  });

  load();
  </script>
</body>
    </html>
